<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 0; }
        .header { background: #1a73e8; color: white; padding: 20px; border-radius: 8px 8px 0 0; }
        .header h1 { margin: 0; }
        .header p { margin: 10px 0 0 0; }
        .stock-section { margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
        .stock-header { padding: 15px; background-color: #f8f9fa; border-bottom: 1px solid #ddd; }
        .stock-header h2 { margin: 0; font-size: 18px; }
        .news-item { padding: 15px; border-bottom: 1px solid #eee; }
        .news-item:last-child { border-bottom: none; }
        .news-title { margin: 0 0 10px 0; font-size: 16px; color: #333; }
        .news-summary { color: #666; margin: 0 0 10px 0; line-height: 1.5; }
        .sentiment { margin-bottom: 10px; }
        .score-badge { display: inline-block; padding: 5px 10px; border-radius: 4px; font-weight: bold; }
        .score-badge.positive { background-color: rgba(52, 168, 83, 0.1); color: #34a853; }
        .score-badge.negative { background-color: rgba(234, 67, 53, 0.1); color: #ea4335; }
        .score-badge.neutral { background-color: rgba(153, 153, 153, 0.1); color: #999; }
        .news-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .news-meta a { margin-left: auto; }
        .news-date { color: #888; font-size: 12px; }
        .footer { text-align: center; padding: 20px; color: #666; background: #f5f5f5; border-radius: 0 0 8px 8px; }
        .footer p { margin: 5px 0; }
        .positive-text { color: #34a853; font-weight: bold; }
        .negative-text { color: #ea4335; font-weight: bold; }
        a { color: #1a73e8; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .no-news { padding: 20px; text-align: center; color: #999; font-style: italic; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š Stock Analysis Report</h1>
        <p>{{ user.username }}ë‹˜ì˜ ê´€ì‹¬ ì¢…ëª© ë¶„ì„ - {{ date }}</p>
    </div>
    
    {% if news_by_stock %}
    <!-- ì¢…ëª©ë³„ ì„¹ì…˜ ë°˜ë³µ -->
    {% for ticker, news_list in news_by_stock.items() %}
    <div class="stock-section">
        <div class="stock-header">
            <h2>{{ ticker }}</h2>
        </div>
        
        {% if news_list %}
        {% for news in news_list %}
        <div class="news-item">
            <h3 class="news-title">{{ news.title }}</h3>
            
            {% if news.summary is mapping %}
            <p class="news-summary">{{ news.summary.get(language, news.summary.get('ko', 'ìš”ì•½ ì—†ìŒ')) }}</p>
            {% else %}
            <p class="news-summary">{{ news.summary }}</p>
            {% endif %}
            
            <div class="sentiment">
                {% set classification = news.sentiment.classification|default('neutral')|lower %}
                {% set score = news.sentiment.score|default(0) %}
                
                {% if classification == 'positive' %}
                <span class="score-badge positive">í˜¸ì¬ ({{ '%+d'|format(score) }})</span>
                {% elif classification == 'negative' %}
                <span class="score-badge negative">ì•…ì¬ ({{ '%+d'|format(score) }})</span>
                {% else %}
                <span class="score-badge neutral">ì¤‘ë¦½ ({{ '%+d'|format(score) }})</span>
                {% endif %}
            </div>
            
            <div class="news-meta">
                <span class="news-date">{{ news.published_date }}</span>
                <a href="{{ news.url|default(news.source_url|default('#')) }}">ì›ë¬¸ ë³´ê¸° â†’</a>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-news">
            <p>ìµœê·¼ 3ì‹œê°„ ë™ì•ˆ ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <div class="no-news" style="padding: 40px; text-align: center;">
        <p>ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    {% endif %}
    
    <div class="footer">
        <p>ì´ {{ total_news }}ê±´ì˜ ë‰´ìŠ¤ | <span class="positive-text">í˜¸ì¬ {{ positive_count }}ê±´</span> | <span class="negative-text">ì•…ì¬ {{ negative_count }}ê±´</span></p>
        <p><a href="{{ dashboard_url }}">ëŒ€ì‹œë³´ë“œì—ì„œ ìì„¸íˆ ë³´ê¸°</a></p>
    </div>
</body>
</html>
